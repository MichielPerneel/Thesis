---
title: "Thesis Results"
author: "Michiel Perneel"
date: "24 april 2019"
output: html_document
---
Here, all thesis results are presented.

```{r setup, include=FALSE}
library(ggplot2)
library(readxl)
library(lubridate)
library(wesanderson)
library(tibble)
library(dplyr)
library(janitor)
library(plyr)
library(anytime)
library(car)
library(ggforce)
library(vegan)
library(tidyr)
library(scales)
library(gridExtra)
library(cowplot)
library(colourpicker)
library(lattice)
library(mgcv)
library(ggpubr)
library(FSA)
```

# Catch results

First, we calculate the total historical catch numbers

```{r}
data_hist <- as_tibble(
  read.csv2(
    "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/Historische glasaalvangst VA.csv",
    sep = ";", header = TRUE, dec = ','
  )
)

# Plot

catch_hist <- ggplot(data_hist, aes(Year, Catch..kg.)) +
  geom_area(color = 'black',  fill = "#e73232") +
  xlab("Year") +
  scale_x_continuous(breaks = c(1960, 1970, 1980, 1990, 2000, 2010)) +
  ylab("Glass eel catch (kg)") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
catch_hist

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/catch_hist.jpeg", catch_hist, width = 30, height = 15, units = "cm")

```

Here, total glass eel catch numbers at the Veurne-Ambacht canal using the 3 different catch techniques are shown.

```{r}
# Totale vangstaantallen for 2017
totalcatch <- as.tibble(read.csv2(
  "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/vangsttotalen_inbo.csv",
  sep = ";", header = TRUE, dec = ","))
  
totalcatch <- filter(totalcatch, Year == 2017)
catch <- ggplot(totalcatch, aes(factor(week.n.), Catch)) +
  geom_col() +
  ylab("Glass eel catch (n° of ind.") +
  xlab("Week (n°)") +
  theme_light() +
  facet_grid(.~Method)
catch
# ------------- Without background data -------------------------------

totalcatch_KR <- filter(totalcatch, Method == "Lift Nets")
catch_KR <- ggplot(totalcatch_KR, aes(factor(week.n.), Catch)) +
  geom_col() +
  xlab("") +
  ylab("Glass eel catch (n° of ind.)") +
  ggtitle("Lift Nets") +
  theme_light() 

totalcatch_PA <- filter(totalcatch, Method == "Eel Ladder")
catch_PA <- ggplot(totalcatch_PA, aes(factor(week.n.), Catch)) +
  geom_col() +
  xlab("") +
  ggtitle("Eel Ladders") +
  ylab("") +
  theme_light() 

totalcatch_SU <- filter(totalcatch, Method == "Artificial Substrates")
catch_SU <- ggplot(totalcatch_SU, aes(factor(week.n.), Catch)) +
  geom_col() +
  xlab("Week (n°)") +
  ylab("") +
  theme_light() +
  ggtitle("Artificial Substrates") 

vangst <- plot_grid(catch_PA, catch_KR, catch_SU, labels = "AUTO", ncol = 1)
vangst
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/vangst.jpeg", 
       vangst, 
       width = 22, height = 28, units = "cm")

#------- With background data ---------------------------------------
totalcatch_KR <- filter(totalcatch, Method == "Lift Nets")
catch_KR <- ggplot(totalcatch_KR, aes(factor(week.n.), Catch)) +
  geom_col(data = totalcatch, aes(factor(week.n.), Catch), fill = "grey") +
  geom_col(fill = "blue") +
  xlab("") +
  ylab("Glass eel catch (n° of ind.)") +
  ggtitle("Lift Nets") +
  theme_light() 

totalcatch_PA <- filter(totalcatch, Method == "Eel Ladder")
catch_PA <- ggplot(totalcatch_PA, aes(factor(week.n.), Catch)) +
  geom_col(data = totalcatch, aes(factor(week.n.), Catch), fill = "grey") +
  geom_col(fill = "red") +
  xlab("") +
  ggtitle("Eel Ladders") +
  ylab("") +
  theme_light()

totalcatch_SU <- filter(totalcatch, Method == "Artificial Substrates")
catch_SU <- ggplot(totalcatch_SU, aes(factor(week.n.), Catch)) +
  geom_col(data = totalcatch, aes(factor(week.n.), Catch), fill = "grey") +
  geom_col(fill = "green") +
  xlab("Week (n°)") +
  ylab("") +
  theme_light() +
  ggtitle("Artificial Substrates")

vangst <- plot_grid(catch_PA, catch_KR, catch_SU, labels = "AUTO", ncol = 1)
vangst
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/vangst_background.jpeg", 
       vangst, 
       width = 22, height = 28, units = "cm")
```

Since a catch sometimes resulted in too many glass eel to count, biometric values were only taken for maximum 100 glass eel during one session. Figures below show how many glass eel were measured in 2017, since this is the year of the thesis' scope.  

```{r}
# Vangstaantallen van glasaal waarvan biometrische waarden genomen werden
data_inbo <- as_tibble(
  read.csv2(
    "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/data_inbo_glasaal_gekuist.csv",
    sep = ";", header = TRUE, dec = ","))

data_inbo_17 <- data_inbo %>%
  mutate(Date = as.Date(Date, format = "%d/%m/%Y")) %>%
  filter(Date >= as.Date('2016-12-31') & Date <= as.Date('2017-12-31')) %>%
  filter(Pigmentation != "potlood") %>%
  filter(Location_type != "SN")
  # Veel potloden in de dataset, moeten deze verwijderd worden?
  # Filter out the biometric data of the glass eel caught in 2017 

pal <- wes_palette("Zissou1", 6, type = "continuous")

catch_measured_17 <- ggplot(data_inbo_17, aes(week(Date), fill = ..count..)) +
  geom_bar() +
  xlab("Week (n°)") +
  ylab("Glass eel measured (n° of ind.)") +
  theme_light() +
  scale_fill_gradient(low = pal[3], high = pal[6]) +
  facet_grid(.~Location_type)
catch_measured_17

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/measured_17_wopotlood.jpeg", 
  catch_measured_17, 
  width = 22, height = 10, units = "cm")
```

# Trends in Biometric values

## Weight

```{r}
Sys.setlocale(category = "LC_ALL", locale = "english") # otherwise labels are in dutch

# Summary statistics 
sapply(data_inbo_17$Weight, mean)
summary(data_inbo_17)
aggregate(data_inbo_17$Weight, list(data_inbo_17$Location_type), mean)
aggregate(data_inbo_17$Weight, list(data_inbo_17$Location_type), sd)
aggregate(data_inbo_17$Weight, list(data_inbo_17$Location_type), min)
aggregate(data_inbo_17$Weight, list(data_inbo_17$Location_type), max)


# Plots
weight_17 <- ggplot(data_inbo_17, aes(x = Date, y = Weight)) +
  geom_point(size = 0.7) +
  geom_smooth()+
  scale_y_continuous(breaks = seq(0, 1000, 100), limits = c(0,1000)) +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week", date_labels = "%W") +
  ylab("Glass eel weight (mg)") +
  theme_light() +
  facet_grid(.~Location_type)
weight_17
#Week of the year as decimal number (00--53) using Monday as the first day of week
#(and typically with the first Monday of the year as day 1 of week 1) (The UK convention)

weight_17_box <- ggplot(data_inbo_17, aes(x = Date, y = Weight, group=week(Date))) +
  geom_boxplot(fill='#A4A4A4', color="black") +
  scale_y_continuous(breaks = seq(0, 1000, 100), limits = c(0,1000)) +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week", date_labels = "%W") +
  ylab("Glass eel weight (mg)") +
  theme_light() +
  facet_grid(.~Location_type) +
  theme(axis.text.x=element_text(angle=60, hjust=1))
weight_17_box

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/weight_17_wopotlood.jpeg", weight_17, width = 22, height = 15, units = "cm")

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/weight_17_boxplot_wopotlood.jpeg", weight_17_box, width = 22, height = 15, units = "cm")
```

## Length

```{r}
# Summary Statistics
aggregate(data_inbo_17$Length, list(data_inbo_17$Location_type), mean)
aggregate(data_inbo_17$Length, list(data_inbo_17$Location_type), sd)
aggregate(data_inbo_17$Length, list(data_inbo_17$Location_type), min)
aggregate(data_inbo_17$Length, list(data_inbo_17$Location_type), max)

# Plots
length_17 <- ggplot(data_inbo_17, aes(x = Date, y = Length)) +
  geom_point(size = 0.7) +
  geom_smooth() +
  ylab("Glass eel length (mm)") +
  scale_x_date(name = "Week (n°) of 2017", date_breaks = "1 week", date_labels = "%W") +
  ggtitle("Length of measured glass eel") +
  theme_light() +
  facet_grid(.~Location_type) +
  theme(axis.text.x=element_text(angle=60, hjust=1))
length_17

length_17_box <- ggplot(data_inbo_17, aes(x = Date, y = Length, group=week(Date))) +
  geom_boxplot(fill='#A4A4A4', color="black") +
  ylab("Glass eel length (mm)") +
  scale_x_date(name = "Week (n°) of 2017", date_breaks = "1 week", date_labels = "%W") +
  ggtitle("Length of measured glass eel") +
  theme_light() +
  facet_grid(.~Location_type) +
  theme(axis.text.x=element_text(angle=60, hjust=1))
length_17_box

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/length_17_wopotlood.jpeg", length_17, width = 22, height = 15, units = "cm")

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/length_17_boxplot_wopotlood.jpeg", length_17_box, width = 22, height = 15, units = "cm")
```


## Condition Factor

```{r}
# ----------------------- The Quest For The Correct Conditon Factor ----------------------

# First, calculate the condition factor as used by Le Cren, since eels grow allometrically

# Plot weight over length
plot(data_inbo_17$Weight~data_inbo_17$Length)

#### Determine relative condition factor
lm1 <- lm(log(data_inbo_17$Weight)~log(data_inbo_17$Length))
summary(lm1) # deduce a and b constants, R²-adjusted = 0.5701 ; Note that a = e^intercept!

e <- exp(1) # back transformation needs an e

data_inbo_17$Condition_factor <- data_inbo_17$Weight/((e^-7.48525) * (data_inbo_17$Length^3.10542))

# ----------------------- Condition Factor Analysis ------------------------------------

# Summary Statistics
data_inbo_17 <- filter(data_inbo_17, !is.na(data_inbo_17$Condition_factor))
aggregate(data_inbo_17$Condition_factor, list(data_inbo_17$Location_type), mean)
aggregate(data_inbo_17$Condition_factor, list(data_inbo_17$Location_type), sd)
aggregate(data_inbo_17$Condition_factor, list(data_inbo_17$Location_type), min)
aggregate(data_inbo_17$Condition_factor, list(data_inbo_17$Location_type), max)

# Plots
condition_17 <- ggplot(data_inbo_17, aes(x = Date, y = Condition_factor)) +
  geom_point(size = 0.7) +
  geom_smooth() +
  ylab("Glass eel condition factor") +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week", date_labels = "%W") +
  theme_light() +
  facet_grid(.~Location_type) +
  geom_hline(yintercept = 1) +
  theme(axis.text.x=element_text(angle=60, hjust=1))
condition_17

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/condition_17_wopotlood.jpeg", condition_17, width = 22, height = 15, units = "cm")

# Zoom on substrates
data_inbo_17_SU <- filter(data_inbo_17, Location_type == "Artificial Substrates")
condition_17_SU <- ggplot(data_inbo_17_SU, aes(x = Date, y = Condition_factor)) +
  geom_point(size = 0.7) +
  geom_smooth() +
  scale_x_date(name = "Week (n°) of 2017", date_breaks = "1 week", date_labels = "%W") +
  ylab("Glass eel condition factor") +
  ggtitle("Condition factor of measured glass eel in the artificial substrates") +
  theme_light() +
  facet_grid(.~Location_type) +
  geom_hline(yintercept = 1) +
  theme(axis.text.x=element_text(angle=60, hjust=1))
condition_17_SU

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/condition_17_SU_wopotlood.jpeg", condition_17_SU, width = 22, height = 15, units = "cm")

# Zoom on eel ladders
data_inbo_17_PA <- filter(data_inbo_17, Location_type == "Eel Ladders")
condition_17_PA <- ggplot(data_inbo_17_PA, aes(x = Date, y = Condition_factor)) +
  geom_point(size = 0.7) +
  geom_smooth() +
  scale_x_date(name = "Week (n°) of 2017", date_breaks = "1 week", date_labels = "%W") +
  ylab("Glass eel condition factor") +
  ggtitle("Condition factor of measured glass eel in the eel ladders") +
  theme_light() +
  facet_grid(.~Location_type) +
  geom_hline(yintercept = 1) +
  theme(axis.text.x=element_text(angle=60, hjust=1))
condition_17_PA

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/condition_17_PA_wopotlood.jpeg", condition_17_PA, width = 22, height = 15, units = "cm")
```


We see that only for the glass eel caught in the substrates, the condition factor starts to rise at the end of the season. For the glass eel found in the eel ladders, the condition factor seems to decline overal. This fits the theory that glass eel migrates until condition reached a lower treshold, upon which they seek to settle. However, the results might be biased due to higher catch numbers in eel ladders, and the second peak might be correlated with the second peak in migration in 2017. To make accurate descriptions of the observed pattern, a polynomial regression is carried out.

### Regression: Polynomial model

```{r}
## Simple polynomial model ####
# Additonal info: https://www.mathworks.com/help/curvefit/polynomial.html
# And: https://datascienceplus.com/fitting-polynomial-regression-r/

# ----------------------- Artificial Substrates --------------------------- 
# 1. Build model and check assumptions

mpol1 <- lm(data_inbo_17_SU$Condition_factor ~ poly(data_inbo_17_SU$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(data_inbo_17_SU$Condition_factor ~ poly(data_inbo_17_SU$Date, 2))
plot(mpol2)
summary(mpol2)
anova(mpol2)
mpol3 <- lm(data_inbo_17_SU$Condition_factor ~ poly(data_inbo_17_SU$Date, 3))
plot(mpol3) 
summary(mpol3)
anova(mpol3)

formula <- y ~ poly(x, 3) # This is the resulting regression formula, cubic term is significant

# 2. Ggplot

CF_SU <- ggplot(data_inbo_17_SU, aes(Date, Condition_factor)) +
  geom_point(colour = pal[2],fill = pal[2]) +
  stat_smooth(colour = pal[2],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  geom_hline(yintercept = 1) +
  theme_bw() +
  ylim(0.5, 1.8) +
  ylab("Condition Factor")  +
  scale_x_date(name = NULL, date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24"))) +
  ylab("Condition Factor")
CF_SU

# ----------------- Eel Ladders -----------------------------
## Explore visually
plot(x=data_inbo_17_PA$Date, y=data_inbo_17_PA$Condition_factor, col=alpha(1,.3), pch=16, cex=1/2)


# 1. Build model and check assumptions

mpol1 <- lm(data_inbo_17_PA$Condition_factor ~ poly(data_inbo_17_PA$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(data_inbo_17_PA$Condition_factor ~ poly(data_inbo_17_PA$Date, 2))
plot(mpol2)
summary(mpol2)
anova(mpol2)
mpol3 <- lm(data_inbo_17_PA$Condition_factor ~ poly(data_inbo_17_PA$Date, 3))
plot(mpol3) 
summary(mpol3)
anova(mpol3) # Cubic term is significant

formula <- y ~ poly(x, 3) # This is the resulting regression formula, cubic term is significant

# 2. Ggplot

CF_PA <- ggplot(data_inbo_17_PA, aes(Date, Condition_factor)) +
  geom_point(colour = pal[6],fill = pal[6]) +
  stat_smooth(colour = pal[6],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  geom_hline(yintercept = 1) +
  theme_bw() +
  ylim(0.5, 1.8) +
  ylab("") +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
CF_PA

# ----------------- Lift Nets -------------------------------
data_inbo_17_KR <- filter(data_inbo_17, Location_type == "Lift Nets")  
## Explore visually
plot(x=data_inbo_17_KR$Date, y=data_inbo_17_KR$Condition_factor, col=alpha(1,.3), pch=16, cex=1/2)

# 1. Build model and check assumptions

mpol1 <- lm(data_inbo_17_KR$Condition_factor ~ poly(data_inbo_17_KR$Date, 1))
plot(mpol1) # Only intercept is significant
summary(mpol1)
anova(mpol1)


formula <- y ~ poly(x, 1) # This is the resulting regression formula, only the intercept is significant

# 2. Ggplot

CF_KR <- ggplot(data_inbo_17_KR, aes(Date, Condition_factor)) +
  geom_point(colour = pal[4],fill = pal[4]) +
  stat_smooth(colour = pal[4],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  geom_hline(yintercept = 1) +
  theme_bw() +
  ylim(0.5, 1.8) +
  ylab("") +
  scale_x_date(name = NULL, date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
CF_KR
# ----------------- Combine into 1 plot ---------------------
condition_regression <- plot_grid(CF_SU, CF_PA, CF_KR, 
                                  labels = c("Artificial Substrates", "Eel Ladder", "Lift Nets"),
                                  ncol = 3, align = 'h', 
                                  label_x = c(0,0.07,0.09),
                                  label_y = c(0.99,0.99,0.99))
condition_regression
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/condition_17_regression.jpeg", condition_regression, width = 40, height = 15, units = "cm")
```

## Pigmentation Stage

```{r}
cols <- c("white", "#c4c4c4", "#007b63", "#ff7f67", "#003f65", "#00c691", "#e8cf87", "#00568d", "#76e2ff")

pigmentation_17 <- ggplot(data_inbo_17, aes(x = Date)) +
  geom_bar(aes(fill = Pigmentation, colour = Pigmentation), width = 2) +
  ylab("Glass eel pigmentation stage") +
  scale_x_date(name = "Week (n°) of 2017", date_breaks = "1 week", date_labels = "%W") +
  ggtitle("Pigmentation of measured glass eel in 2017") +
  theme_light() +
  facet_grid(.~Location_type) +
  theme(axis.text.x=element_text(angle=60, hjust=1))
pigmentation_17

# Zoom on SU

pigmentation_17_SU <- ggplot(data_inbo_17_SU, aes(x = Date, fill = Pigmentation)) +
  geom_bar(aes(fill = Pigmentation), width = 2) +
  ylab("Glass eel pigmentation stage") +
  scale_x_date(name = "Week (n°) of 2017", date_breaks = "1 week", date_labels = "%W") +
  ggtitle("Pigmentation of measured glass eel in artificial substrates in 2017") +
  theme_light() +
  theme(axis.text.x=element_text(angle=60, hjust=1))
pigmentation_17_SU

# Zoom on PA

pigmentation_17_PA <- ggplot(data_inbo_17_PA, aes(x = Date, fill = Pigmentation)) +
  geom_bar(aes(fill = Pigmentation), width = 2) +
  ylab("Glass eel pigmentation stage") +
  scale_x_date(name = "Week (n°) of 2017", date_breaks = "1 week", date_labels = "%W") +
  ggtitle("Pigmentation of measured glass eel in eel ladders in 2017") +
  theme_light() +
  theme(axis.text.x=element_text(angle=60, hjust=1))
pigmentation_17_PA

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/pigmentation_17_wopotlood.jpeg", pigmentation_17, width = 26, height = 15, units = "cm")

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/pigmentation_17_SU_wopotlood.jpeg", pigmentation_17_SU, width = 26, height = 15, units = "cm")

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/pigmentation_17_PA_wopotlood.jpeg", pigmentation_17_PA, width = 26, height = 15, units = "cm")
```

Here, it is clear that younger pigmentation stages are relatively more present at eel ladders, while substrates catch more pigmented glass eel.

# Trends in Stomach content

```{r}
maaginhoud <- as.tibble(read.csv2("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/Maaginhoud3.csv",
                                  sep = ";", dec = ","))
maaginhoud <- maaginhoud %>%
  mutate(datum = as.Date(datum, format = "%d/%m/%Y"))
head(maaginhoud)
```

## Stomach content analysis

```{r}
# Algemeen
## Gather data for multivariate analysis in PRIMER
temp <- select(maaginhoud, Anorganic.Material:Plantae.sp.)
write.csv(temp, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/maaginhoud_multi.csv")
### Only work with most abundant species

sort(colSums(maaginhoud[8:25]))
maaginhoud2 <- maaginhoud %>%
  mutate(Other = Annelida + Coleoptera.Larvae + Pennate.diatom + Isopoda + Hexapoda.sp. + Diptera.sp. + Crustaceae.sp. + Calanoida.sp. + Chironomida.sp. + Plantae.sp.)  %>% # Minimal occurrence of 40
  select( Methode, datum, Stomach, Locatie_VA, Anorganic.Material, Amphipoda.sp., Polychaete, Copepoda.sp., Cladocera.sp., Unidentified.sp., Harpacticoida.sp., Cyclopoida.sp., Other)

# ------------------------------------- Barplot per methode -------------------------------------------
 
maaginhoud_meth <- select(maaginhoud2, Methode, Anorganic.Material:Other)


## Samenvatten per methode
maaginhoud_meth <- aggregate(maaginhoud_meth[2:10], by=list(Methode = maaginhoud_meth$Methode), FUN=sum)
maaginhoud_meth <- mutate(maaginhoud_meth, Method_total = rowSums(maaginhoud_meth[2:10]))

## Frequency of occurrence ipv absolute numbers
for (i in 2:length(maaginhoud_meth)) {
  maaginhoud_meth[i] <- maaginhoud_meth[i] / maaginhoud_meth$Method_total
}

write.csv(maaginhoud_meth, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/maaginhoud_method.csv")

your.mat.data = c(0.01542589,0.02079142,0.04493628,0.07042254,0.0221328,0.05298457,0.217974514,0.53923541,0.01609658,0.01308615,0.01308615,0.03380589,0.04143948,0.1308615,0.07306434,0.006543075,0.65757906,0.03053435,0.12195122,0.00000000,0.07317073,0.00000000,0.0000000,0.46341463,0.146341463,0.09756098,0.09756098)
data <- matrix(data = your.mat.data, 
               nrow = 3,
               ncol = 9,
               byrow = TRUE)
colnames(data)=c("Anorganic.Material","Amphipoda.sp.","Polychaete","Copepoda.sp.","Cladocera.sp.","Unidentified.sp.","Harpacticoida.sp.","Cyclopoida.sp.","Other")
rownames(data)=c("Eel Ladders", "Artificial Substrates", "Lift Nets")

data <- t(data)
data <- data * 100

cols <- c("#c4c4c4", "#007b63", "#ff7f67", "#003f65", "#00c691", "#e8cf87", "#00568d", "#76e2ff", "#717171")

barplot(data, horiz = TRUE, col = cols, 
        border="white", space=0.04, font.axis=2, las = 2, cex.names = 0.7, xlab="Frequency of Occurrence (%)")
legend("bottom", legend=rownames(data), fill = cols, title="Groep")

# ------------------- AS & Time as a discrete variable ---------------------------------------------
maaginhoud_su <- filter(maaginhoud2, Methode == "Artificial Substrates"  & Locatie_VA != "Ganzepoot")
maaginhoud_su <- mutate(maaginhoud_su, week = week(maaginhoud_su$datum))

## Only Occurrence data + time
maaginhoud_su_occurrence_time <- maaginhoud_su[5:14]

## Samenvatten per week
maaginhoud_su_occurrence_time <- aggregate(maaginhoud_su_occurrence_time[1:9], by=list(Week = maaginhoud_su_occurrence_time$week), FUN=sum)
maaginhoud_su_occurrence_time <- mutate(maaginhoud_su_occurrence_time, Week_total = rowSums(maaginhoud_su_occurrence_time[2:10]))


## Frequency of occurrence ipv absolute numbers
for (i in 2:length(maaginhoud_su_occurrence_time)) {
  maaginhoud_su_occurrence_time[i] <- maaginhoud_su_occurrence_time[i] / maaginhoud_su_occurrence_time$Week_total
}

write.csv(maaginhoud_su_occurrence_time, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/maaginhoud_AS_time.csv")
# https://app.datawrapper.de/chart/BqCAW/publish Handig om kleuren te kiezen, ook: https://blog.datawrapper.de/colorguide/

## Stacked Bargraphs voor SC, MI & PG samen, aparte bargraphs maken per week, en per week het aantal lege magen weergeven

your.mat.data = c(0.022222222,0.00000000,0.022222222,0.00000000,0.00000000,0.044444444,0.000000000,0.88888889,0.022222222,0.000000000,0.00000000,0.000000000,0.00000000,0.00000000,0.833333333,0.000000000,0.00000000,0.166666667,0.142857143,0.00000000,0.142857143,0.00000000,0.00000000,0.714285714,0.000000000,0.00000000,0.000000000,0.000000000,0.00000000,0.111111111,0.00000000,0.00000000,0.555555556,0.000000000,0.00000000,0.333333333,0.083333333,0.00000000,0.000000000,0.00000000,0.00000000,0.333333333,0.000000000,0.58333333,0.000000000,0.010309278,0.13402062,0.051546392,0.06185567,0.00000000,0.051546392,0.041237113,0.61855670,0.030927835,0.009724473,0.00000000,0.009724473,0.12641815,0.02755267,0.008103728,0.001620746,0.81361426,0.003241491,0.009345794,0.00000000,0.074766355,0.00000000,0.01869159,0.037383178,0.112149533,0.71028037,0.037383178,0.012345679,0.01234568,0.135802469,0.02469136,0.00000000,0.074074074,0.209876543,0.50617284,0.024691358,0.052631579,0.13157895,0.210526316,0.00000000,0.00000000,0.223684211,0.276315789,0.06578947,0.039473684,0.016746411,0.01674641,0.035885167,0.04545455,0.03349282,0.023923445,0.645933014,0.17224880,0.009569378)
data <- matrix(data = your.mat.data, 
               nrow = 11,
               ncol = 9,
               byrow = TRUE)
colnames(data)=c("Anorganic Material", "Amphipoda sp.", "Polychaete sp.", "Copepoda sp.", "Cladocera sp.", "Unidentified sp.", "Harpacticoida sp.", "Cyclopoida sp.", "Other")
rownames(data)=c("11 (E = 2)","12 (E = 4)","13 ( E = 3)", "14 (E = 1)", "15 (E = 2)", "16 ( E = 1)", "17 (E = 0)", "18 (E = 0)", "19 (E = 0)", "20 (E = 0)", "21 (E = 0)")

data <- t(data)
data <- data * 100
barplot(data, horiz = TRUE, col = cols, 
        border="white", space=0.04, font.axis=2, las = 2, cex.names = 0.7, xlab="Frequency of Occurrence (%)")
legend("bottom", legend=rownames(data), fill = cols, title="Groep")

## ---------------- AS & Location in Veurne-Ambacht ------------------------------

 
maaginhoud_VA <- maaginhoud2 %>%
  filter(Methode == "Artificial Substrates" & Locatie_VA != "Ganzepoot") %>%
  select(Locatie_VA, Anorganic.Material:Other)
  
factor(maaginhoud_VA$Locatie_VA, levels = c("Middle Veurne-Ambacht", "Pumping Station", "Sluice Complex"))

## Samenvatten per Locatie
maaginhoud_VA <- aggregate(maaginhoud_VA[2:10], by=list(Locatie = maaginhoud_VA$Locatie_VA), FUN=sum)
maaginhoud_VA <- mutate(maaginhoud_VA, Location_total = rowSums(maaginhoud_VA[2:10]))

maaginhoud_VA <- maaginhoud_VA %>%
  arrange(factor(Locatie, levels = c("Sluice Complex", "Middle Veurne-Ambacht", "Pumping Station")))

## Frequency of occurrence ipv absolute numbers
for (i in 2:length(maaginhoud_VA)) {
  maaginhoud_VA[i] <- maaginhoud_VA[i] / maaginhoud_VA$Location_total
}

write.csv(maaginhoud_VA, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/maaginhoud_AS_VA.csv")

your.mat.data = c(0.023255814,0.049095607,0.0620155,0.03359173,0.005167959,0.03875969,0.52196382,0.2480620,0.01808786,0.014348786,0.003311258,0.0187638,0.09933775,0.033112583,0.03752759,0.09492274,0.6876380,0.01103753,0.005494505,0.049450549,0.1263736,0.01098901,0.005494505,0.10439560,0.20329670,0.4615385,0.03296703) # Klaar tot hier!
data <- matrix(data = your.mat.data, 
               nrow = 3,
               ncol = 9,
               byrow = TRUE)
colnames(data)=c("Anorganic.Material","Amphipoda.sp.","Polychaete","Copepoda.sp.","Cladocera.sp.","Unidentified.sp.","Harpacticoida.sp.","Cyclopoida.sp.","Other")
rownames(data)=c("Eel Ladders", "Artificial Substrates", "Lift Nets")

data <- t(data)
data <- data * 100
barplot(data, horiz = TRUE, col = cols, border="white", space=0.04, font.axis=2, las = 2, cex.names = 0.7, xlab="Frequency of Occurrence (%)")
legend("bottom", legend=rownames(data), fill = cols, title="Groep")

## ------ ------- EL & time as a discrete variable --------------------------------
maaginhoud_el <- filter(maaginhoud2, Methode == "Eel Ladder"  & Locatie_VA != "Ganzepoot")
maaginhoud_el <- mutate(maaginhoud_el, week = week(maaginhoud_el$datum))

## Only Occurrence data + time
maaginhoud_el_occurrence_time <- maaginhoud_el[5:14]

## Samenvatten per week
maaginhoud_el_occurrence_time <- aggregate(maaginhoud_el_occurrence_time[1:9], by=list(Week = maaginhoud_el_occurrence_time$week), FUN=sum)
maaginhoud_el_occurrence_time <- mutate(maaginhoud_el_occurrence_time, Week_total = rowSums(maaginhoud_el_occurrence_time[2:10]))


## Frequency of occurrence ipv absolute numbers
for (i in 2:length(maaginhoud_el_occurrence_time)) {
  maaginhoud_el_occurrence_time[i] <- maaginhoud_el_occurrence_time[i] / maaginhoud_el_occurrence_time$Week_total
}
maaginhoud_el_occurrence_time[is.na(maaginhoud_el_occurrence_time)] <- 0

write.csv(maaginhoud_el_occurrence_time, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/maaginhoud_el_occurrence_time.csv")

## Stacked Bargraphs voor SC, MI & PG samen, aparte bargraphs maken per week, en per week het aantal lege magen weergeven

your.mat.data = c(0.000000000,0.00000000,0.000000000,0.000000000,0.00000000,0.00000000,0.000000000,0.0000000,0.000000000,0.000000000,0.00000000,0.400000000,0.000000000,0.00000000,0.60000000,0.000000000,0.0000000,0.000000000,0.000000000,0.00000000,0.111111111,0.000000000,0.00000000,0.55555556,0.000000000,0.0000000,0.333333333,0.000000000,0.00000000,0.000000000,0.000000000,0.00000000,0.57142857,0.000000000,0.0000000,0.428571429,0.000000000,0.00000000,0.000000000,0.000000000,0.00000000,1.00000000,0.000000000,0.0000000,0.000000000,0.012987013,0.00000000,0.012987013,0.038961039,0.00000000,0.07792208,0.012987013,0.8051948,0.038961039,0.026785714,0.00000000,0.008928571,0.000000000,0.03571429,0.02678571,0.000000000,0.8660714,0.035714286,0.019801980,0.00000000,0.000000000,0.009900990,0.02475248,0.02475248,0.000000000,0.9059406,0.014851485,0.006756757,0.00000000,0.040540541,0.108108108,0.04729730,0.07432432,0.013513514,0.6824324,0.027027027,0.008474576,0.00000000,0.042372881,0.101694915,0.19491525,0.09322034,0.016949153,0.5000000,0.042372881,0.020408163,0.01020408,0.061224490,0.040816327,0.25510204,0.09183673,0.000000000,0.5000000,0.020408163,0.000000000,0.08088235,0.066176471,0.007352941,0.41176471,0.03676471,0.007352941,0.3823529,0.007352941)
data <- matrix(data = your.mat.data, 
               nrow = 12,
               ncol = 9,
               byrow = TRUE)
colnames(data)=c("Anorganic Material", "Amphipoda sp.", "Polychaete sp.", "Copepoda sp.", "Cladocera sp.", "Unidentified sp.", "Harpacticoida sp.", "Cyclopoida sp.", "Other")
rownames(data)=c("10 (E = )","11 (E = )","12 (E = )","13 ( E = )", "14 (E = )", "15 (E = )", "16 ( E = )", "17 (E = )", "18 (E = )", "19 (E = )", "20 (E = )", "21 (E = )")

data <- t(data)
data <- data * 100
barplot(data, horiz = TRUE, col = cols, 
        border="white", space=0.04, font.axis=2, las = 2, cex.names = 0.7, xlab="Frequency of Occurrence (%)")
legend("bottom", legend=rownames(data), fill = cols, title="Groep")

# --------------------- Lift Nets ----------------------

maaginhoud_LN <- filter(maaginhoud2, Methode == "Lift Nets")
maaginhoud_LN <- mutate(maaginhoud_LN, week = week(maaginhoud_LN$datum))

## Only Occurrence data + time
maaginhoud_LN_occurrence_time <- maaginhoud_LN[5:14]

## Samenvatten per week
maaginhoud_LN_occurrence_time <- aggregate(maaginhoud_LN_occurrence_time[1:9], 
                                           by=list(Week = maaginhoud_LN_occurrence_time$week), FUN=sum)
maaginhoud_LN_occurrence_time <- mutate(maaginhoud_LN_occurrence_time, 
                                        Week_total = rowSums(maaginhoud_LN_occurrence_time[2:10]))


## Frequency of occurrence ipv absolute numbers
for (i in 2:length(maaginhoud_LN_occurrence_time)) {
  maaginhoud_LN_occurrence_time[i] <- maaginhoud_LN_occurrence_time[i] / maaginhoud_LN_occurrence_time$Week_total
}

write.csv(maaginhoud_LN_occurrence_time, 
          file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/maaginhoud_LN_time.csv")
```

Maybe these need to be checked as well: percent prey contribution (%N), frequency of occurrence (%O), percent weight (%W), and index of relative importance (%IRI)

## Fulness Index

```{r}
maaginhoud <- maaginhoud %>%
  mutate(datum = as.Date(datum, format = "%d/%m/%Y")) %>%
  mutate(ratio_visceral_total = Gewicht.maag.darmstelsel / Gewicht.Glasaal)

Fulness_17 <- ggplot(maaginhoud, aes(x = datum, y = ratio_visceral_total)) +
  geom_point(size = 0.9, aes(color = Stomach)) +
  scale_colour_manual(values = c('red','black')) +
  geom_smooth() +
  ylab("Glass eel fulness index") +
  ggtitle("Fulness index of dissected glass eel") +
  theme_light() +
  facet_grid(.~Methode) +
  scale_x_date(name = "Date (Day-Month)", 
               date_breaks = "2 weeks", date_minor_breaks = "1 week", date_labels = "%d-%b") +
  scale_y_continuous(breaks = seq(0, 0.25, 0.0500), limits = c(0,0.25)) +
  theme(axis.text.x=element_text(angle=60, hjust=1))
Fulness_17

# Zoom on Artificial Substrates

maaginhoud_SU <- maaginhoud %>% 
  filter(Methode == "Artificial Substrates") %>%
  filter(Locatie_VA != 'Ganzepoot')

maaginhoud_SU$Locatie_VA <- factor(maaginhoud_SU$Locatie_VA, 
                                   levels = c("Sluice Complex", "Middle Veurne-Ambacht", "Pumping Station"))

Fulness_17_SU <- ggplot(maaginhoud_SU, aes(x = datum, y = ratio_visceral_total)) +
  geom_point(size =0.9, aes(color = Stomach)) +
  scale_colour_manual(values = c('red','black')) +
  geom_smooth() +
  ylab("Glass eel in Artifical Substrates fulness index") +
  ggtitle("Fulness index of dissected glass eel sampled in Artificial Substrates") +
  theme_light() +
  facet_grid(.~Locatie_VA) +
  scale_x_date(name = "Date (Day-Month)", 
               date_breaks = "2 weeks", date_minor_breaks = "1 week", date_labels = "%d-%b") +
  scale_y_continuous(breaks = seq(0, 0.25, 0.0500), limits = c(0,0.25)) +
  theme(axis.text.x=element_text(angle=60, hjust=1))  
Fulness_17_SU  

# Zoom on Eel ladders

maaginhoud_PA <- maaginhoud %>%
  filter(Methode == "Eel Ladder")

Fulness_17_PA <- ggplot(maaginhoud_PA, aes(x = datum, y = ratio_visceral_total)) +
  geom_point(size = 0.9, aes(color = Stomach)) +
  scale_colour_manual(values = c('red','black')) +
  geom_smooth() +
  ylab("Glass eel in Eel Ladders fulness index") +
  ggtitle("Fulness index of dissected glass eel sampled in Eel Ladders") +
  theme_light() +
  scale_x_date(name = "Date (Day-Month)", 
               date_breaks = "2 weeks", date_minor_breaks = "1 week", date_labels = "%d-%b") +
  scale_y_continuous(breaks = seq(0, 0.25, 0.0500), limits = c(0,0.25)) +
  theme(axis.text.x=element_text(angle=60, hjust=1))  
Fulness_17_PA

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/Fulness.jpeg", 
       Fulness_17, width = 28, height = 15, units = "cm")

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/Fulness_SU.jpeg", 
       Fulness_17_SU, width = 28, height = 15, units = "cm")

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/Fulness_PA.jpeg", 
       Fulness_17_PA, width = 28, height = 15, units = "cm")
```

### Polynomial regression on FI

```{r}
# ----------------------- Artificial Substrates --------------------------- 
# 1. Build model and check assumptions

mpol1 <- lm(maaginhoud_SU$ratio_visceral_total ~ poly(maaginhoud_SU$datum, 1))
plot(mpol1) # It seems like there's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(maaginhoud_SU$ratio_visceral_total ~ poly(maaginhoud_SU$datum, 2))
plot(mpol2) # However, the quadratic term is insignificant
summary(mpol2)
anova(mpol2)
mpol3 <- lm(maaginhoud_SU$ratio_visceral_total ~ poly(maaginhoud_SU$datum, 3))
plot(mpol3) 
summary(mpol3)
anova(mpol3)

formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are insignificant

# 2. Ggplot
FI_SU <- ggplot(maaginhoud_SU, aes(datum, ratio_visceral_total)) +
  geom_point(size = 0.9, aes(color = Stomach)) +
  scale_colour_manual(values = c('red','black')) +
  stat_smooth(colour = pal[2],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  ylab("") +
  ylim(0.00, 0.20) +
  theme(legend.position="none") +
  scale_x_date(name = NULL, date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
FI_SU
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/FI_AS_regr.jpeg", 
       FI_SU, width = 28, height = 15, units = "cm")

FI_SU_VA <- ggplot(maaginhoud_SU, aes(datum, ratio_visceral_total)) +
  geom_point(size = 0.9, aes(color = Stomach)) +
  scale_colour_manual(values = c('red','black')) +
  stat_smooth(colour = pal[2],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position = "none") +
  ylab("Fulness Index")  +
  ylim(0.00,0.20) +
  facet_grid(.~Locatie_VA) +
  scale_x_date(name = NULL, date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
FI_SU_VA # If we construct this figure, do we need to test polynomial regressions on all three locations?

# ----------------------- Eel ladder --------------------------- 
mpol1 <- lm(maaginhoud_PA$ratio_visceral_total ~ poly(maaginhoud_PA$datum, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(maaginhoud_PA$ratio_visceral_total ~ poly(maaginhoud_PA$datum, 2))
plot(mpol2) # However, only first term is significant
summary(mpol2)
anova(mpol2) 
mpol3 <- lm(maaginhoud_PA$ratio_visceral_total ~ poly(maaginhoud_PA$datum, 3))
plot(mpol3) 
summary(mpol3)
anova(mpol3)

formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are notsignificant

# 2. Ggplot
FI_PA <- ggplot(maaginhoud_PA, aes(datum, ratio_visceral_total)) +
  geom_point(size = 0.9, aes(color = Stomach)) +
  scale_colour_manual(values = c('red','black')) +
  stat_smooth(colour = pal[2],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("")  +
  ylim(0.00, 0.2) +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
FI_PA
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/FI_PA_regr.jpeg", FI_PA, width = 28, height = 15, units = "cm")

FI_regression <- plot_grid(FI_SU, FI_SU_VA, FI_PA, 
                                  labels = c("Artificial Substrates", 
                                             "Artificial Substrates by Location", 
                                             "Eel Ladder"),
                                  ncol = 1, align = 'v', 
                                  hjust = 0, 
                                  label_x = 0.10,
                                  label_y = 1,
                                  label_size = 11,
                                  scale = 0.9)
FI_regression
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/FI_17_regression.jpeg", FI_regression, width = 30, height = 30, units = "cm")

```

## Diversity Indices

```{r}
maaginhoud <- maaginhoud %>%
  mutate(Shannon = diversity(maaginhoud[8:25], index="shannon", MARGIN=1, base=exp(1))) %>%
  mutate(Simpson = diversity(maaginhoud[8:25], index="simpson", MARGIN=1, base=exp(1)))
```

### Polynomial Regression on Shannon Diversity
```{r}
# ----------------------- Artificial substrates ----------------
maaginhoud_SU <- filter(maaginhoud, Methode == "Artificial Substrates")
mpol1 <- lm(maaginhoud_SU$Shannon ~ poly(maaginhoud_SU$datum, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(maaginhoud_SU$Shannon ~ poly(maaginhoud_SU$datum, 2))
plot(mpol2) # Quadratic term significant
summary(mpol2)
anova(mpol2) 
mpol3 <- lm(maaginhoud_SU$Shannon ~ poly(maaginhoud_SU$datum, 3))
plot(mpol3) # Cubic term significant
summary(mpol3)
anova(mpol3)

formula <- y ~ poly(x, 3) 
# This is the resulting polynomial regression formula, quadratic and cubic term are significant

# 2. Ggplot
Shannon_SU <- ggplot(maaginhoud_SU, aes(datum, Shannon)) +
  geom_point(size = 0.9, colour = pal[2]) +
  stat_smooth(colour = pal[2],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("Shannon diversity index")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
Shannon_SU

# ----------------------- Eel ladder --------------------------- 
maaginhoud_PA <- filter(maaginhoud, Methode == "Eel Ladder")
mpol1 <- lm(maaginhoud_PA$Shannon ~ poly(maaginhoud_PA$datum, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(maaginhoud_PA$Shannon ~ poly(maaginhoud_PA$datum, 2))
plot(mpol2) # However, only first term is significant
summary(mpol2)
anova(mpol2) 
mpol3 <- lm(maaginhoud_PA$Shannon ~ poly(maaginhoud_PA$datum, 3))
plot(mpol3) 
summary(mpol3)
anova(mpol3)

formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are notsignificant

# 2. Ggplot
Shannon_PA <- ggplot(maaginhoud_PA, aes(datum, Shannon)) +
  geom_point(size = 0.9, colour = pal[6]) +
  stat_smooth(colour = pal[6],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("Shannon Diversity Index")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
Shannon_PA

#----------------- Lift Nets --------------------------------------
maaginhoud_KR <- filter(maaginhoud, Methode == "Lift Nets")
mpol1 <- lm(maaginhoud_KR$Shannon ~ poly(maaginhoud_KR$datum, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(maaginhoud_KR$Shannon ~ poly(maaginhoud_KR$datum, 2))
plot(mpol2) 
summary(mpol2)
anova(mpol2) 
mpol3 <- lm(maaginhoud_KR$Shannon ~ poly(maaginhoud_KR$datum, 3))
plot(mpol3) 
summary(mpol3) # Cubic term is significant
anova(mpol3)

formula <- y ~ poly(x, 3) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
Shannon_KR <- ggplot(maaginhoud_KR, aes(datum, Shannon)) +
  geom_point(size = 0.9, colour = pal[6]) +
  stat_smooth(colour = pal[6],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("Shannon Diversity Index")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
Shannon_KR

## Weird result, too few sample points I would not include this in the regression analysis

# ------------- Combine in one plot ---------------------------

Shannon_regression <- plot_grid(Shannon_SU, Shannon_PA, 
                                  labels = c("Artificial Substrates", 
                                             "Eel Ladder"),
                                  ncol = 1, align = 'v', 
                                  hjust = 0, 
                                  label_x = 0.10,
                                  label_y = 1,
                                  label_size = 11,
                                  scale = 0.9)
Shannon_regression
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/Shannon_regr.jpeg", 
       Shannon_regression, width = 28, height = 30, units = "cm")
```

### Polynomial regression on Simpson Diversity

```{r}
# ----------------------- Artificial substrates ----------------
mpol1 <- lm(maaginhoud_SU$Simpson ~ poly(maaginhoud_SU$datum, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(maaginhoud_SU$Simpson ~ poly(maaginhoud_SU$datum, 2))
plot(mpol2) # Quadratic term significant
summary(mpol2)
anova(mpol2) 
mpol3 <- lm(maaginhoud_SU$Simpson ~ poly(maaginhoud_SU$datum, 3))
plot(mpol3) # Cubic term significant
summary(mpol3)
anova(mpol3)

formula <- y ~ poly(x, ) 
# ? Check polynomial regression analysis!!

# 2. Ggplot
Simpson_SU <- ggplot(maaginhoud_SU, aes(datum, Simpson)) +
  geom_point(size = 0.9, colour = pal[2]) +
  stat_smooth(colour = pal[2],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
Simpson_SU

# ----------------------- Eel ladder --------------------------- 
mpol1 <- lm(maaginhoud_PA$Simpson ~ poly(maaginhoud_PA$datum, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(maaginhoud_PA$Simpson ~ poly(maaginhoud_PA$datum, 2))
plot(mpol2) # However, only first term is significant
summary(mpol2)
anova(mpol2) 
mpol3 <- lm(maaginhoud_PA$Simpson ~ poly(maaginhoud_PA$datum, 3))
plot(mpol3) 
summary(mpol3)
anova(mpol3)

formula <- y ~ poly(x, ) 
# ? Check polynomial regression analysis!! Cubic term is significant, but quadratic term isn't!

# 2. Ggplot
Simpson_PA <- ggplot(maaginhoud_PA, aes(datum, Simpson)) +
  geom_point(size = 0.9, colour = pal[6]) +
  stat_smooth(colour = pal[6],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
Simpson_PA

Simpson_regression <- plot_grid(Simpson_SU, Simpson_PA, 
                                  labels = c("Artificial Substrates", 
                                             "Eel Ladder"),
                                  ncol = 1, align = 'v', 
                                  hjust = 0, 
                                  label_x = 0.10,
                                  label_y = 1,
                                  label_size = 11,
                                  scale = 0.9)
Simpson_regression
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/Simpson_regr.jpeg", 
       Simpson_regression, width = 28, height = 30, units = "cm")
```


# Trends in Fatty Acid Composition

Workflow:
- 1 multivariate & univariate approach based on the absolute concentrations (mg/g, g/100g)  
    -> If the need arises to transform the data, use double square root
  
- 1 multivariate & univariate approach based on the relative frequencies (eg. g/100g / total FA)
    -> If the need arises to transform the data, use log transformation
    -> due to homeostasy, it could very well be that this results in a patten only in frequency analysis
    
    
# --------------- Absolute FA Concentrations --------------------------------
    
```{r}
FA_abs <- as.tibble(read.csv2("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/Fatty Acids Abs.csv", 
                              sep = ";", header = TRUE, dec = ","))

data_inbo2 <- as.tibble(read.csv2("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/Glass eel stock deepfreeze 2017.csv", 
                                  sep = ";", dec = ","))

temp <- select(data_inbo2, nr, pigmentation.stage, condition.factor)
maaginhoud_env <- select(maaginhoud, nr, datum, Methode, Locatie_VA, Gewicht.Glasaal, Gewicht.maag.darmstelsel, Stomach, ratio_visceral_total)
FA_env_abs <- left_join(FA_abs, temp, by = "nr")
FA_env_abs <- left_join(FA_env_abs, maaginhoud_env, by = "nr")

FA_env_abs <- FA_env_abs %>%
  mutate(Date = as.Date(datum, format = "%d/%m/%Y")) %>%
  mutate(Week = week(Date))

# Delete samples below 0
FA_env_abs[FA_env_abs < 0] <- NA
FA_env_abs <-FA_env_abs[complete.cases(FA_env_abs),]

# Split up the table according to method non-artificial substrate glass eel
FA_abs_AS <- filter(FA_env_abs, Methode == "Artificial Substrates")
FA_abs_EL <- filter(FA_env_abs, Methode == "Eel Ladder")
FA_abs_LN <- filter(FA_env_abs, Methode == "Lift Nets")

## Aggregate per week
temp <-select(FA_abs_AS, X14.00:X22.6n.3, Week)
temp_mean <- aggregate(temp[1:24], 
                  by=list(Week = temp$Week), FUN=mean)
temp_sd <- aggregate(temp[1:24], 
                  by=list(Week = temp$Week), FUN=sd)

write.csv(temp_mean, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_time_abs_mean_AS.csv")
write.csv(temp_sd, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_time_abs_sd_AS.csv")

## Aggregate per method

temp <- select(FA_env_abs, X14.00:X22.6n.3, Methode)
temp_mean <- aggregate(temp[1:24], 
                  by=list(Method = temp$Methode), FUN=mean)
temp_sd <- aggregate(temp[1:24], 
                  by=list(Method = temp$Methode), FUN=sd)
write.csv(temp_mean, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_abs_mean_method.csv")
write.csv(temp_sd, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_abs_sd_method.csv")

## Aggregate per location in VA
temp <- select(FA_abs_AS, X14.00:X22.6n.3, Locatie_VA)
temp <- filter(temp, Locatie_VA != "Ganzepoot")

temp_mean <- aggregate(temp[1:24], 
                  by=list(LocationVA = temp$Locatie_VA), FUN=mean)
temp_sd <- aggregate(temp[1:24], 
                  by=list(LocationVA = temp$Locatie_VA), FUN=sd)

write.csv(temp_mean, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_abs_mean_AS_locationVA.csv")
write.csv(temp_sd, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_abs_sd_AS_locationVA.csv")
```


# --------------- Relative FA Frequencies --------------------------------

```{r}
FA_rel <- as.tibble(read.csv2("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/Fatty Acids Rel.csv", 
                              sep = ";", header = TRUE, dec = ","))

temp <- select(data_inbo2, nr, pigmentation.stage, condition.factor)

FA_env_rel <- left_join(FA_rel, temp, by = "nr")
FA_env_rel <- left_join(FA_env_rel, maaginhoud_env, by = "nr")

FA_env_rel <- FA_env_rel %>%
  mutate(Date = as.Date(datum, format = "%d/%m/%Y")) %>%
  mutate(Week = week(Date))

# Delete samples that were deleted due to negative absolute values
FA_env_rel <- FA_env_rel[(FA_env_rel$nr %in% FA_env_abs$nr),]

# Split up the table according to method non-artificial substrate glass eel
FA_rel_AS <- filter(FA_env_rel, Methode == "Artificial Substrates")
FA_rel_EL <- filter(FA_env_rel, Methode == "Eel Ladder")
FA_rel_LN <- filter(FA_env_rel, Methode == "Lift Nets")

# Agregate per week
temp <-select(FA_rel_AS, X14.00:X22.6n.3, Week)
temp_mean <- aggregate(temp[1:24], 
                  by=list(Week = temp$Week), FUN=mean)
temp_sd <- aggregate(temp[1:24], 
                  by=list(Week = temp$Week), FUN=sd)

write.csv(temp_mean, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_time_rel_mean_AS.csv")
write.csv(temp_sd, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_time_rel_sd_AS.csv")

# Aggregate per method
temp <- select(FA_env_rel, X14.00:X22.6n.3, Methode)
temp_mean <- aggregate(temp[1:24], 
                  by=list(Method = temp$Methode), FUN=mean)
temp_sd <- aggregate(temp[1:24], 
                  by=list(Method = temp$Methode), FUN=sd)

write.csv(temp_mean, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_rel_mean_method.csv")
write.csv(temp_sd, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_rel_sd_method.csv")

# Aggregate per location in VA
temp <- select(FA_rel_AS, X14.00:X22.6n.3, Locatie_VA)
temp <- filter(temp, Locatie_VA != "Ganzepoot")
temp_mean <- aggregate(temp[1:24], 
                  by=list(LocationVA = temp$Locatie_VA), FUN=mean)
temp_sd <- aggregate(temp[1:24], 
                  by=list(LocationVA = temp$Locatie_VA), FUN=sd)

write.csv(temp_mean, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_rel_AS_mean_locationVA.csv")
write.csv(temp_sd, file = "C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Thesis/data/raw/FA_rel_AS_sd_locationVA.csv")
```



# Multivariate Statistics on rel. FA concentrations & time

## MDS

Workflow: MDS, PERMANOVA, SIMPER

```{r}
# H0: Groups do not differ in spread/position in multivariate space

# -------------- MDS ----------------------
# Prepare data
fa.mat <- as.matrix(FA_rel_AS[2:25])
#fa.mat.log <- log(fa.mat) # Use square root to minimize influence of most abundant groups -> log is motly used for measurable data
fa.mds <- metaMDS(fa.mat, distance = "bray", k=2, trymax = 35, autotransform = TRUE)
fa.mds
stressplot(fa.mds)

data.scores <- as.data.frame(scores(fa.mds))
data.scores$Week <- factor(FA_rel_AS$Week)
data.scores$Locatie_VA <- FA_rel_AS$Locatie_VA
head(data.scores)

pal <- wes_palette("Zissou1", 11, type = "continuous")

MDS <- ggplot(data.scores, aes(NMDS1, NMDS2, colour = factor(Week))) + 
  geom_point(position = position_jitter(.1), size=3) +
  stat_ellipse(type = 't', size = 1) +
  scale_colour_manual(values=pal) +
  coord_equal() +
  theme_minimal() +
  labs(colour = "Week (n°)") 
MDS

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/MDS.jpeg", 
       MDS, width = 20, height = 15, units = "cm")

## Fit condition factor, Locatie_VA, FI as arrows
env <- select(FA_rel_AS, CF = condition.factor, FI = ratio_visceral_total)
fit <- envfit(fa.mds, env)
arrow <- data.frame(fit$vectors$arrows, R = fit$vectors$r, P = fit$vectors$pvals)
arrow$Biometrics <- rownames(arrow)
arrow.p <- filter(arrow, P <= 0.05)

p <- ggplot(data.scores, aes(NMDS1, NMDS2)) +
  geom_point(data=data.scores, aes(NMDS1, NMDS2, colour = Week), position = position_jitter(.1)) +
  scale_colour_manual(values=pal) +
  stat_ellipse(aes(fill=Week), alpha = .2, type = 't', size=1, geom = "polygon") +
  theme_minimal() +
  geom_segment(data=arrow.p, aes(x=0, y=0, xend=NMDS1, yend=NMDS2, label = Biometrics, lty = Biometrics),
               arrow = arrow(length = unit(.2, "cm")*arrow.p$R)) 
p

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/MDS_envfit.jpeg", 
       p, width = 20, height = 15, units = "cm")

# ------------- ANOSIM ----------------------
fa.anosim <- anosim(fa.mat, FA_rel_AS$Week, permutations = 999, distance = "bray", strata = NULL,
    parallel = getOption("mc.cores"))
fa.anosim
summary(fa.anosim)
plot(fa.anosim)

# ------------- PERMANOVA -------------------

fa.dist <- vegdist(fa.mat, method = "bray")

set.seed(42) #reproducible results
fa.div <- adonis2(fa.dist~Week * FA_rel_AS$`Condition Factor` * FI * FA_rel_AS$Stomach,
                  data=FA_rel_AS, permutations = 999, method = "bray", strata="PLOT")
fa.div

# ------------ SIMPER ---------------------

sim <- simper(fa.mat, FA_rel_AS$Week)
sim 

# Obtain the dissimilarity indices between weeks
library(pairwiseAdonis)
pairdiffs <- pairwise.adonis(fa.mat, FA_rel_AS$Week)
pairdiffs.sign <- filter(pairdiffs, p.value < 0.05)
```

## PCA

```{r}
library(ggfortify)
library(data.table)
library(ggbiplot)

# Include biomarkers in the PCA
FA_rel_AS <- FA_rel_AS %>%
  mutate(A = X22.6n.3 /X20.5n.3 ) %>%
  mutate(B = (X18.2n.6 + X18.3n.3 + X18.4n.3 + X20.3n.6 + X20.4n.3 + X20.4n.6 + X20.5n.3 + X22.5n.3 + X22.5n.6 + X22.6n.3 + X18.2n.6) /
           (X14.00 + X15.00 + X16.00 + X17.00 + X18.00 + X20.00 + X22.00 + cis.9.16.1 + X16.1.iso.17.0 + X17.1.16.2 + cis.9.18.1 + cis.11.18.1 + X20.01 + X24.01.00)) %>%
  mutate(C = X20.5n.3 / X20.4n.6) %>%
  mutate(D = (X18.3n.3 + X18.4n.3 + X20.4n.3 + X20.5n.3 + X22.5n.3 +  X22.6n.3 ) / (X18.2n.6 +  X20.3n.6 + X20.4n.6  + X22.5n.6 + X18.2n.6)) %>%
  mutate(E = (X20.5n.3 + X22.6n.3) / (X18.2n.6 + X18.3n.3 + X18.4n.3 + X20.3n.6 + X20.4n.3 + X20.4n.6 + X20.5n.3 + X22.5n.3 + X22.5n.6 + X22.6n.3 + X18.2n.6 + X14.00 + X15.00 + X16.00 + X17.00 + X18.00 + X20.00 + X22.00 + cis.9.16.1 + X16.1.iso.17.0 + X17.1.16.2 + cis.9.18.1 + cis.11.18.1 + X20.01 + X24.01.00))

FA_rel_AS <- setnames(FA_rel_AS, old=colnames(FA_rel_AS), new=c("nr","14:00", "15:00", "16:00", "16:1 iso 17:0", "16:1 (cis-9)", "17:00", "17:1 + 16:2", "18:00", "18:1 (cis-9)", "18:1 (cis-11)", "18:2 (n-6)", "20:00", "18:3 (n-3)", "20:1", "18:4 (n-3)", "20:3 (n-6)", "22:00", "20:4 (n-6)", "20:4 (n-3)", "20:5 (n-3)", "24:1", "22:5 (n-6)", "22:5 (n-3)", "22:6 (n-3)", "Pigmentation Stage", "Condition Factor", "datum", "Method", "Location VA", "Glass eel weight", "Weight stomach and gut", "Stomach", "FI", "Date", "Week", "DHA/EPA", "PUFA/(SFA + MUFA)", "EPA/AA", "n-3/n-6", "FLQ"))

FA_rel_AS_PCA <- select(FA_rel_AS, "14:00":"22:6 (n-3)")


pca <- autoplot(prcomp(FA_rel_AS_PCA), data = FA_rel_AS, type = "obs",
         loadings = TRUE, loadings.colour = "light grey", loadings.label = TRUE, loadings.label.size = 3,
         mapping=aes( size = factor(FA_rel_AS$Week)))

fa.pca <- prcomp(FA_rel_AS_PCA)
ggbiplot::ggbiplot(fa.pca, obs.scale = 1, var.scale = 1, group=factor(FA_rel_AS$Week),
     varname.size = 3, labels.size=3, ellipse = FALSE, circle = TRUE) +
  geom_point(aes(colour=factor(FA_rel_AS$Week)), size = 3) +
  scale_colour_manual(values=pal) +
  theme(legend.direction ="vertical", 
      legend.position = "right")

## contribution to PCA
library(FactoMineR)
library(factoextra)
fa.pca2 <- PCA(FA_rel_AS_PCA)
print(fa.pca2)
eigenvalues <- fa.pca2$eig
eigenvalues

head(fa.pca2$var$contrib)
fviz_pca_var(fa.pca2, col.var="contrib")
contrib1 <- fviz_pca_contrib(fa.pca2, choice = "var", axes = 1, top = 3)
contrib2 <-fviz_pca_contrib(fa.pca2, choice = "var", axes = 2, top = 3)
pca3 <- fviz_pca_var(fa.pca2)

bottom.row <- plot_grid(contrib1, contrib2, 
                           labels = c("B", "C"),
                                  ncol = 2, align = 'h', 
                                  hjust = 0, 
                                  label_x = 0.10,
                                  label_y = 1,
                                  label_size = 11,
                                  scale = 0.9)
pca_FA <- plot_grid(pca3, bottom.row, labels = c('A', ''), ncol = 1, rel_heights = c(4, 2))
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/PCA_CONTR.jpeg", pca_FA, width = 20, height = 20, units = "cm")

# --------- Eel Ladder -------------
FA_rel_EL <- FA_rel_EL %>%
  mutate(Biom1 = X22.6n.3 /X20.5n.3 ) %>%
  mutate( Biom2 = (X18.2n.6 + X18.3n.3 + X18.4n.3 + X20.3n.6 + X20.4n.3 + X20.4n.6 + X20.5n.3 + X22.5n.3 + X22.5n.6 + X22.6n.3) /
           (X14.00 + X15.00 + X16.00 + X17.00 + X18.00 + X20.00 + X22.00)) %>%
  mutate(C = X20.5n.3 / X20.4n.6) %>%
  mutate(D = (X18.3n.3 + X18.4n.3 + X20.4n.3 + X20.5n.3 + X22.5n.3 +  X22.6n.3 ) / (X18.2n.6 +  X20.3n.6 + X20.4n.6  + X22.5n.6 + X18.2n.6)) %>%
  mutate(E = (X20.5n.3 + X22.6n.3) / (X18.2n.6 + X18.3n.3 + X18.4n.3 + X20.3n.6 + X20.4n.3 + X20.4n.6 + X20.5n.3 + X22.5n.3 + X22.5n.6 + X22.6n.3 + X18.2n.6 + X14.00 + X15.00 + X16.00 + X17.00 + X18.00 + X20.00 + X22.00 + cis.9.16.1 + X16.1.iso.17.0 + X17.1.16.2 + cis.9.18.1 + cis.11.18.1 + X20.01 + X24.01.00))

FA_rel_EL <- setnames(FA_rel_EL, old=colnames(FA_rel_EL), new=c("nr","14:00", "15:00", "16:00", "16:1 iso 17:0", "16:1 (cis-9)", "17:00", "17:1 + 16:2", "18:00", "18:1 (cis-9)", "18:1 (cis-11)", "18:2 (n-6)", "20:00", "18:3 (n-3)", "20:1", "18:4 (n-3)", "20:3 (n-6)", "22:00", "20:4 (n-6)", "20:4 (n-3)", "20:5 (n-3)", "24:1", "22:5 (n-6)", "22:5 (n-3)", "22:6 (n-3)", "Pigmentation Stage", "Condition Factor", "datum", "Method", "Location VA", "Glass eel weight", "Weight stomach and gut", "Stomach", "FI", "Date", "Week", "DHA/EPA", "PUFA/(SFA + MUFA)", "EPA/AA", "n-3/n-66", "FLQ"))

FA_rel_EL_PCA <- select(FA_rel_EL, "14:00":"22:6 (n-3)")


pca <- autoplot(prcomp(FA_rel_EL_PCA), data = FA_rel_EL, type = "obs",
         loadings = TRUE, loadings.colour = "light grey", loadings.label = TRUE, loadings.label.size = 3,
         mapping=aes( size = factor(FA_rel_EL$Week)))
pca
fa.pca <- prcomp(FA_rel_EL_PCA)
ggbiplot::ggbiplot(fa.pca, obs.scale = 1, var.scale = 1, group=factor(FA_rel_EL$Week),
     varname.size = 3, labels.size=3, ellipse = FALSE, circle = TRUE) +
  geom_point(aes(colour=factor(FA_rel_EL$Week)), size = 3) +
  scale_colour_manual(values=pal) +
  theme(legend.direction ="vertical", 
      legend.position = "right")

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/PCA.jpeg", pca, width = 20, height = 15, units = "cm")
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/PCA_biplot.jpeg", pca2, width = 30, height = 20, units = "cm")

```


# Univariate statistical analysis of FA

```{r}
# --------------------------  TOTAL FA ---------------------------
mpol1 <- lm(FA_abs_AS$total.Fatty.acids ~ poly(FA_abs_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_abs_AS$total.Fatty.acids ~ poly(FA_abs_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term nonsignificant, linear regression
anova(mpol2) 

formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
TotalFA <- ggplot(FA_abs_AS, aes(Date, total.Fatty.acids)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("Total Fatty Acids (abs.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
TotalFA

#-------------------- FLQ -----------------------
mpol1 <- lm(FA_rel_AS$FLQ ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$FLQ ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term not sign.
anova(mpol2) 


formula <- y ~ poly(x, 1)

FLQ <- ggplot(FA_rel_AS, aes(Date, FLQ)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("FLQ (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
FLQ
#-------------------------- DHA/EPA --------------------------
mpol1 <- lm(FA_rel_AS$`DHA/EPA` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`DHA/EPA` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term sign.
anova(mpol2) 
mpol3 <- lm(FA_rel_AS$`DHA/EPA` ~ poly(FA_rel_AS$Date, 3))
plot(mpol3) 
summary(mpol3) # third term not sign.
anova(mpol3) 

formula <- y ~ poly(x, 2) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
biom1 <- ggplot(FA_rel_AS, aes(Date, `DHA/EPA`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("DHA/EPA (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
biom1

## ----- PUFA/(SFA + MUFA) -------------------
mpol1 <- lm(FA_rel_AS$`PUFA/(SFA + MUFA)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`PUFA/(SFA + MUFA)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term NOT sign.
anova(mpol2) 


formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
biom2 <- ggplot(FA_rel_AS, aes(Date, `PUFA/(SFA + MUFA)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("PUFA/(SFA + MUFA) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
biom2

## ----- EPA/AA -------------------
mpol1 <- lm(FA_rel_AS$`EPA/AA` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`EPA/AA` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term  sign.
anova(mpol2) 


formula <- y ~ poly(x, 2) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
biom3 <- ggplot(FA_rel_AS, aes(Date, `EPA/AA`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("EPA/AA (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
biom3

## ----- n-3/n-6 -------------------
mpol1 <- lm(FA_rel_AS$`n-3/n-6` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`n-3/n-6` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term NOT sign.
anova(mpol2) 


formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
biom4 <- ggplot(FA_rel_AS, aes(Date, `n-3/n-6`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("n-3/n-6 (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
biom4


# --------- Combine plots -----------------
bottom.row <- plot_grid(biom1, biom2, biom3, biom4,
                           labels = c("B", "C", "D", "E"),
                                  ncol = 2, align = 'h', 
                                  hjust = 0, 
                                  label_x = 0.10,
                                  label_y = 1,
                                  label_size = 11,
                                  scale = 0.9)
FA_regression1<- plot_grid(TotalFA, bottom.row, labels = c('A', ''), ncol = 1, rel_heights = c(3, 2.5))
FA_regression1

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/FA_17_regression.jpeg", FA_regression1, width = 30, height = 30, units = "cm")

## --------------------- Eel Ladder -----------------
# --------------------------  TOTAL FA ---------------------------
mpol1 <- lm(FA_abs_EL$total.Fatty.acids ~ poly(FA_abs_EL$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_abs_EL$total.Fatty.acids ~ poly(FA_abs_EL$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term nonsignificant, linear regression
anova(mpol2) 

formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
FA_abs_EL <- filter(FA_abs_EL, total.Fatty.acids < 1000)
TotalFA_EL <- ggplot(FA_abs_EL, aes(Date, total.Fatty.acids)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("Total Fatty Acids (abs.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
TotalFA_EL

# -------------- FLQ -----------

mpol1 <- lm(FA_rel_EL$FLQ ~ poly(FA_rel_EL$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_EL$FLQ ~ poly(FA_rel_EL$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term not sign.
anova(mpol2) 


formula <- y ~ poly(x, 1)

FLQ_EL <- ggplot(FA_rel_EL, aes(Date, FLQ)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("FLQ (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
FLQ_EL

#-------------------------- DHA/EPA --------------------------
mpol1 <- lm(FA_rel_EL$`DHA/EPA` ~ poly(FA_rel_EL$Date, 1))
plot(mpol1) # nothing significant
summary(mpol1)
anova(mpol1)

# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
biom1_EL <- ggplot(FA_rel_EL, aes(Date, `DHA/EPA`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm") +
  theme_bw() +
  theme(legend.position="none") +
  ylab("DHA/EPA (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
biom1_EL

## ----- PUFA/(SFA + MUFA) -------------------
mpol1 <- lm(FA_rel_EL$`PUFA/(SFA + MUFA)` ~ poly(FA_rel_EL$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_EL$`PUFA/(SFA + MUFA)` ~ poly(FA_rel_EL$Date, 2))
plot(mpol2) # SECOND TERM NOT SIGN
summary(mpol2)
anova(mpol2)

formula <- y ~ poly(x, 1) 

# 2. Ggplot
biom2_EL <- ggplot(FA_rel_EL, aes(Date, `PUFA/(SFA + MUFA)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("PUFA/(SFA + MUFA) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))

biom2_EL
## ----- EPA/AA -------------------
mpol1 <- lm(FA_rel_EL$`EPA/AA` ~ poly(FA_rel_EL$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_EL$`EPA/AA` ~ poly(FA_rel_EL$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term NOT sign.
anova(mpol2) 


formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
biom3_EL <- ggplot(FA_rel_EL, aes(Date, `EPA/AA`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("EPA/AA (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
biom3_EL

## ----- n-3/n-6 -------------------
mpol1 <- lm(FA_rel_EL$`n-3/n-66` ~ poly(FA_rel_EL$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_EL$`n-3/n-66` ~ poly(FA_rel_EL$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term NOT sign.
anova(mpol2) 


formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
biom4_EL <- ggplot(FA_rel_EL, aes(Date, `n-3/n-66`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("n-3/n-6 (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
biom4_EL

# --------- Combine plots -----------------
bottom.row <- plot_grid(biom1_EL, biom2_EL, biom3_EL, biom4_EL,
                           labels = c("B", "C", "D", "E"),
                                  ncol = 2, align = 'h', 
                                  hjust = 0, 
                                  label_x = 0.10,
                                  label_y = 1,
                                  label_size = 11,
                                  scale = 0.9)
FA_regression1_EL<- plot_grid(TotalFA_EL, bottom.row, labels = c('A', ''), ncol = 1, rel_heights = c(3, 2.5))
FA_regression1_EL

ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/FA_17_regression_EL.jpeg", FA_regression1_EL, width = 30, height = 30, units = "cm")
```


### Omega 3 FA 
```{r}
#-------------------------- 18:3 (n-3) --------------------------
mpol1 <- lm(FA_rel_AS$`18:3 (n-3)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`18:3 (n-3)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term NOT sign.
anova(mpol2) 


formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
p18.3 <- ggplot(FA_rel_AS, aes(Date, `18:3 (n-3)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..,..adj.rr.label.., sep = "~~~~")),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("18:3 (n-3) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p18.3

#-------------------------- 18:4 (n-3) --------------------------
mpol1 <- lm(FA_rel_AS$`18:4 (n-3)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`18:4 (n-3)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term NOT sign.
anova(mpol2) 


formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant
p18.4 <- ggplot(FA_rel_AS, aes(Date, `18:4 (n-3)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..,..adj.rr.label.., sep = "~~~~")),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("18:4 (n-3) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p18.4

#-------------------------- 20:4 (n-3) --------------------------
mpol1 <- lm(FA_rel_AS$`20:4 (n-3)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`20:4 (n-3)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term  sign.
anova(mpol2) 
mpol3 <- lm(FA_rel_AS$`20:4 (n-3)` ~ poly(FA_rel_AS$Date, 3))
plot(mpol3) 
summary(mpol3) # THIRD term NOT sign.
anova(mpol3) 

formula <- y ~ poly(x, 2) 
# This is the resulting linear regression formula, quadratic and cubic term are significant
p20.4 <- ggplot(FA_rel_AS, aes(Date, `20:4 (n-3)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..,..adj.rr.label.., sep = "~~~~")),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("20:4 (n-3) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p20.4

#-------------------------- 20:5 (n-3) --------------------------
mpol1 <- lm(FA_rel_AS$`20:5 (n-3)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`20:5 (n-3)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term sign.
anova(mpol2) 
mpol3 <- lm(FA_rel_AS$`20:5 (n-3)` ~ poly(FA_rel_AS$Date, 3))
plot(mpol3) 
summary(mpol3) # third term not sign.
anova(mpol3) 

formula <- y ~ poly(x, 2) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
p20.5 <- ggplot(FA_rel_AS, aes(Date, `20:5 (n-3)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..,..adj.rr.label.., sep = "~~~~")),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("20:5 (n-3) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p20.5
#-------------------------- 22:5 (n-3) --------------------------
mpol1 <- lm(FA_rel_AS$`22:5 (n-3)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`22:5 (n-3)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term sign.
anova(mpol2) 
mpol3 <- lm(FA_rel_AS$`22:5 (n-3)` ~ poly(FA_rel_AS$Date, 3))
plot(mpol3) 
summary(mpol3) # third term  sign.
anova(mpol3) 

formula <- y ~ poly(x, 3) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
p22.5 <- ggplot(FA_rel_AS, aes(Date, `22:5 (n-3)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..,..adj.rr.label.., sep = "~~~~")),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("22:5 (n-3) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p22.5

#-------------------------- DHA --------------------------
mpol1 <- lm(FA_rel_AS$`22:6 (n-3)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`22:6 (n-3)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term sign.
anova(mpol2) 
mpol3 <- lm(FA_rel_AS$`22:6 (n-3)` ~ poly(FA_rel_AS$Date, 3))
plot(mpol3) 
summary(mpol3) # third term not sign.
anova(mpol3) 

formula <- y ~ poly(x, 3) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
pDHA <- ggplot(FA_rel_AS, aes(Date, `22:6 (n-3)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..,..adj.rr.label.., sep = "~~~~")),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("22:6 (n-3) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
pDHA

FA_regression_omega3 <- plot_grid(p18.3, p18.4, p20.4, p20.5, p22.5, pDHA, 
                           labels = c("A", "B", "C", "D", "E", "F"),
                                  ncol = 2, align = 'v', 
                                  hjust = 0, 
                                  label_x = 0.10,
                                  label_y = 1,
                                  label_size = 11,
                                  scale = 0.9)
FA_regression_omega3
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/FA_17_regression_omega3.jpeg", FA_regression_omega3, width = 25, height = 30, units = "cm")

```


### Omega 6 FA

```{r}
#-------------------------- 18:2 (n-6) --------------------------
mpol1 <- lm(FA_rel_AS$`18:2 (n-6)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # no significant change
summary(mpol1)
anova(mpol1)

# 2. Ggplot
p18.2.6 <- ggplot(FA_rel_AS, aes(Date, `18:2 (n-6)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm") +
  theme_bw() +
  theme(legend.position="none") +
  ylab("18:2 (n-6) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p18.2.6

#-------------------------- 20:3 (n-6) --------------------------
mpol1 <- lm(FA_rel_AS$`20:3 (n-6)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`20:3 (n-6)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term NOT sign.
anova(mpol2) 


formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
p20.3.6 <- ggplot(FA_rel_AS, aes(Date, `20:3 (n-6)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..,..adj.rr.label.., sep = "~~~~")),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("20:3 (n-6) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p20.3.6

#-------------------------- 20:4 (n-6) --------------------------
mpol1 <- lm(FA_rel_AS$`20:4 (n-6)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`20:4 (n-6)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term NOT sign.
anova(mpol2) 


formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
p20.4.6 <- ggplot(FA_rel_AS, aes(Date, `20:4 (n-6)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..,..adj.rr.label.., sep = "~~~~")),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("20:4 (n-6) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p20.4.6

#-------------------------- 22:5 (n-6) --------------------------
mpol1 <- lm(FA_rel_AS$`22:5 (n-6)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`22:5 (n-6)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term NOT sign.
anova(mpol2) 


formula <- y ~ poly(x, 1) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
p22.5.6 <- ggplot(FA_rel_AS, aes(Date, `22:5 (n-6)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..,..adj.rr.label.., sep = "~~~~")),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("22:5 (n-6) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p22.5.6


FA_regression_omega6 <- plot_grid(p18.2.6, p20.3.6, p20.4.6, p22.5.6, 
                           labels = c("A", "B", "C", "D"),
                                  ncol = 2, align = 'v', 
                                  hjust = 0, 
                                  label_x = 0.10,
                                  label_y = 1,
                                  label_size = 11,
                                  scale = 0.9)
FA_regression_omega6
ggsave("C:/Users/Admin/OneDrive/Documenten/Biologie/Master/Thesis/Images/R Results/FA_17_regression_omega6.jpeg", FA_regression_omega6, width = 25, height = 25, units = "cm")
```


### SFA

```{r}
#-------------------------- 16:00 --------------------------
mpol1 <- lm(FA_rel_AS$`16:00` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`16:00` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term sign.
anova(mpol2) 
mpol3 <- lm(FA_rel_AS$`16:00` ~ poly(FA_rel_AS$Date, 3))
plot(mpol3) 
summary(mpol3) # third term not sign.
anova(mpol3) 

formula <- y ~ poly(x, 2) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
p16 <- ggplot(FA_rel_AS, aes(Date, `16:00`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("16:00 (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p16


#--------------------------  18:00 --------------------------
mpol1 <- lm(FA_rel_AS$`18:00` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`18:00` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term sign.
anova(mpol2) 
mpol3 <- lm(FA_rel_AS$`18:00` ~ poly(FA_rel_AS$Date, 3))
plot(mpol3) 
summary(mpol3) # third term not sign.
anova(mpol3) 

formula <- y ~ poly(x, 2) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
p18 <- ggplot(FA_rel_AS, aes(Date, `18:00`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("18:00 (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p18


```

### MUFA
```{r}
#-------------------------- 18:1 (cis-9) --------------------------
mpol1 <- lm(FA_rel_AS$`18:1 (cis-9)` ~ poly(FA_rel_AS$Date, 1))
plot(mpol1) # There's still a signal present in the residual data
summary(mpol1)
anova(mpol1)
mpol2 <- lm(FA_rel_AS$`18:1 (cis-9)` ~ poly(FA_rel_AS$Date, 2))
plot(mpol2) 
summary(mpol2) # Second term sign.
anova(mpol2) 
mpol3 <- lm(FA_rel_AS$`18:1 (cis-9)` ~ poly(FA_rel_AS$Date, 3))
plot(mpol3) 
summary(mpol3) # third term not sign.
anova(mpol3) 
formula <- y ~ poly(x, 2) 
# This is the resulting linear regression formula, quadratic and cubic term are significant

# 2. Ggplot
p18.1 <- ggplot(FA_rel_AS, aes(Date, `18:1 (cis-9)`)) +
  geom_point(size = 0.9, colour = pal[1]) +
  stat_smooth(colour = pal[1],method = "lm", formula = formula) +
  stat_regline_equation(aes(label =  paste(..eq.label..)),
                        label.y.npc = 0.97,
                        formula = formula) +
  theme_bw() +
  theme(legend.position="none") +
  ylab("18:1 (cis-9) (rel.)")  +
  scale_x_date(name = "Week (n°)", date_breaks = "1 week",
               date_labels = "%W",
               limits = c(as.Date("2017-03-03"),as.Date("2017-05-24")))
p18.1


```

